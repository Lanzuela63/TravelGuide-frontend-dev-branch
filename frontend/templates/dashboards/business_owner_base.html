{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Business Owner Dashboard{% endblock %} | Bicol TravelGuide</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    /* Sidebar */
    #sidebar-wrapper {
      width: 250px;
      min-height: 100vh;
      transition: all 0.3s ease;
    }
    #wrapper.toggled #sidebar-wrapper {
      margin-left: -250px;
    }
    .sidebar-heading {
      font-size: 1.2rem;
      font-weight: bold;
    }
    .list-group-item {
      border: none;
      padding: 1rem;
      transition: all 0.2s ease;
    }
    .list-group-item:hover {
      background-color: #f0f0f0;
    }

    /* Page content */
    #page-content-wrapper {
      flex: 1;
      transition: margin-left 0.3s ease;
    }

    /* Cards */
    .card {
      border: none;
      border-radius: 0.75rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: translateY(-3px);
    }

    /* Table */
    table td button {
      margin-right: 0.25rem;
    }
  </style>
</head>
<body>

<div class="d-flex" id="wrapper">

  <!-- Sidebar -->
  <div class="border-end bg-white" id="sidebar-wrapper">
    <div class="sidebar-heading text-center py-4">üè¢ Business Panel</div>
    <div class="list-group list-group-flush">
      <a href="{% url 'public-home' %}" class="list-group-item list-group-item-action" target="_blank">
        <i class="fa-solid fa-globe me-2"></i> View Website
      </a>
      <a href="{% url 'business_owner_dash:dashboard' %}" class="list-group-item list-group-item-action">
        <i class="fa-solid fa-house me-2"></i> Home
      </a>
      <a href="{% url 'business_owner_dash:business_list' %}" class="list-group-item list-group-item-action">
        <i class="fa-solid fa-briefcase me-2"></i> My Businesses
      </a>
      <a href="#" class="list-group-item list-group-item-action disabled">
        <i class="fa-solid fa-gear me-2"></i> Settings (coming soon)
      </a>
    </div>
  </div>

  <!-- Page content -->
  <div id="page-content-wrapper" class="w-100">

    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom px-3">
      <button class="btn btn-outline-primary" id="sidebarToggle"><i class="fa-solid fa-bars"></i></button>
      <div class="ms-auto dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
          <i class="fa-solid fa-user-circle me-1"></i> {{ request.user.username }}
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="{% url 'view_profile' %}">Profile</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" href="{% url 'account_logout' %}">Logout</a></li>
        </ul>
      </div>
    </nav>

    <!-- Content -->
    <main>
        {% block content %}
        {% endblock %}
    </main>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Sidebar Toggle
  const sidebarToggle = document.getElementById('sidebarToggle');
  const wrapper = document.getElementById('wrapper');
  sidebarToggle.addEventListener('click', () => {
    wrapper.classList.toggle('toggled');
  });

  // Counter Animation (optional, can be moved to specific pages)
  const counters = document.querySelectorAll('.counter');
  if (counters.length > 0) {
      counters.forEach(counter => {
        counter.innerText = '0';
        const updateCounter = () => {
          const target = +counter.getAttribute('data-target');
          const current = +counter.innerText;
          const increment = target / 50;
          if (current < target) {
            counter.innerText = `${Math.ceil(current + increment)}`;
            setTimeout(updateCounter, 30);
          } else {
            counter.innerText = target;
          }
        };
        updateCounter();
      });
  }

  // Chart.js (optional, can be moved to specific pages)
  const visitorChart = document.getElementById('visitorChart');
  if (visitorChart) {
      fetch("{% url 'admin_dash:chart_data' %}") // This might need to be a different URL for business owner dashboard
        .then(response => response.json())
        .then(data => {
          const ctx = visitorChart.getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'Visitors',
                data: data.data,
                fill: true,
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                tension: 0.4
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: true },
              },
              scales: {
                y: { beginAtZero: true }
              }
            }
          });
        });
  }
</script>
{% block extra_js %}{% endblock %}
</body>
</html>
